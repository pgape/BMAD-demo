# 四人麻将游戏核心系统 - 产品需求文档 (PRD)

## 1. 目标和背景上下文 (Goals and Background Context)

### 目标
1. 开发一个可运行的四人麻将游戏原型，验证核心游戏流程的可行性
2. 实现完整的牌局设置、游戏循环、响应处理和胜负判定机制
3. 确保核心游戏机制正常运行，为后续完整开发奠定基础
4. 实现准确的胡牌判断和符合规则的响应处理

### 背景上下文
麻将作为中国传统棋牌游戏，拥有广泛的用户基础。本项目旨在开发一个数字版的四人麻将游戏，以验证核心游戏流程的可行性。通过构建一个可运行的原型，我们将验证从牌局设置到游戏结束的完整流程，包括洗牌、发牌、摸牌、打牌、响应处理（吃、碰、杠、胡）以及胜负判定等关键环节。

### 变更日志
| 日期 | 版本 | 描述 | 作者 |
|------|------|------|------|
| 2026-01-10 | 1.0 | 创建初始PRD文档 | BMad PM |

## 2. 需求 (Requirements)

### 2.1 功能需求 (Functional)
1. **FR1**: 系统应支持136张标准麻将牌（不含花牌）的初始化和管理
2. **FR2**: 系统应实现洗牌和砌墙功能，确保随机性
3. **FR3**: 系统应自动为4位玩家发牌，每位玩家获得13张起始手牌
4. **FR4**: 系统应实现游戏主循环，包括摸牌、打牌机制
5. **FR5**: 系统应支持玩家操作，包括暗杠等行为
6. **FR6**: 系统应处理玩家响应，包括吃、碰、杠、胡等操作
7. **FR7**: 系统应实现基础胡牌评估，支持平胡等简单牌型判断
8. **FR8**: 系统应跟踪游戏状态、玩家手牌和牌墙剩余数量
9. **FR9**: 系统应能够识别并宣布游戏结束及获胜者

### 2.2 非功能需求 (Non Functional)
1. **NFR1**: 游戏响应时间应在合理范围内，确保流畅的游戏体验
2. **NFR2**: 系统应具备良好的错误处理能力，防止因异常输入导致游戏崩溃
3. **NFR3**: 游戏逻辑应严格按照传统麻将规则执行，确保准确性
4. **NFR4**: 系统应具备基本的日志记录功能，便于调试和问题追踪
5. **NFR5**: 系统应支持至少4个并发玩家在同一游戏房间内进行游戏
6. **NFR6**: 网络延迟应控制在200ms以内以保证流畅的游戏体验
7. **NFR7**: 系统应具备防作弊机制，检测异常游戏行为
8. **NFR8**: 断线重连功能应在30秒内完成，且不中断游戏进程
9. **NFR9**: 系统应验证所有玩家操作的合法性，防止非法操作
10. **NFR10**: 系统应记录所有关键游戏事件，用于审计和调试

## 3. 用户界面设计目标 (User Interface Design Goals)

### 3.1 整体UX愿景
创建直观易懂的麻将游戏界面，让玩家能够轻松理解当前游戏状态，快速进行操作。界面应清晰展示玩家手牌、已出牌区域、游戏状态信息等关键元素。

### 3.2 关键交互范式
- 鼠标点击选择要打出的牌
- 点击按钮响应其他玩家的操作（吃、碰、杠、胡）
- 清晰的状态提示和操作指引

### 3.3 核心屏幕和视图
1. **游戏大厅**: 选择房间、开始游戏
2. **游戏主界面**: 展示四位玩家位置、手牌、桌面出牌区、游戏状态
3. **结算界面**: 显示胡牌结果、得分统计

### 3.4 无障碍访问
- None (当前版本不包含特殊无障碍功能)

### 3.5 品牌
- 采用传统中国风元素，体现麻将文化的特色

### 3.6 目标设备和平台
- Web响应式，支持桌面端和移动端

## 4. 技术假设 (Technical Assumptions)

### 4.1 仓库结构
- Monorepo (单一代码库)

### 4.2 服务架构
- 单体应用 (Monolith)，前后端分离架构

### 4.3 测试要求
- 单元测试 + 集成测试 (Unit + Integration)

### 4.4 其他技术假设和请求
- 前端: 使用现代前端框架（如React或Vue）
- 后端: 使用Node.js或Python等适合游戏逻辑的语言
- 数据存储: 轻量级数据库或内存存储（用于原型阶段）
- 实时通信: WebSocket或其他实时通信协议
- 部署: 容器化部署（Docker）

## 5. 史诗列表 (Epic List)

1. **Epic 1: 基础游戏框架与设置**: 建立项目基础设施，实现麻将牌管理和基础游戏设置
2. **Epic 2: 核心游戏循环**: 实现游戏主循环，包括摸牌、打牌机制
3. **Epic 3: 响应处理系统**: 实现吃、碰、杠、胡等玩家响应处理
4. **Epic 4: 胜负判定与游戏结束**: 实现胡牌判断和游戏结束逻辑

## 6. 史诗详情 (Epic Details)

### Epic 1: 基础游戏框架与设置
建立项目基础设施，实现麻将牌管理和基础游戏设置

#### Story 1.1 初始化麻将牌系统
As a 游戏开发者,
I want 初始化136张标准麻将牌，
so that 游戏可以使用正确的牌组进行。

**验收标准**:
1. 1: 系统成功创建136张标准麻将牌（不含花牌）
2. 2: 牌面种类完整，包括万子、筒子、条子、字牌
3. 3: 每种牌的数量正确（除字牌外每种4张）

#### Story 1.2 洗牌和砌墙功能
As a 游戏开发者,
I want 实现洗牌和砌墙功能，
so that 每次游戏开始时牌序随机。

**验收标准**:
1. 1: 洗牌算法确保牌序随机分布
2. 2: 砌墙成功形成四个牌墙，每个牌墙长度一致
3. 3: 洗牌和砌墙过程高效且无重复

#### Story 1.3 玩家手牌分配
As a 游戏开发者,
I want 自动为4位玩家分配初始手牌，
so that 游戏可以正常开始。

**验收标准**:
1. 1: 每位玩家获得13张起始手牌
2. 2: 分配过程公平且随机
3. 3: 确保没有重复发牌或遗漏

### Epic 2: 核心游戏循环
实现游戏主循环，包括摸牌、打牌机制

#### Story 2.1 摸牌机制
As a 游戏开发者,
I want 实现玩家摸牌功能，
so that 游戏可以按顺序进行。

**验收标准**:
1. 1: 玩家可以从牌墙顶部摸牌
2. 2: 摸牌后更新牌墙剩余数量
3. 3: 摸牌动作不影响其他玩家的手牌

#### Story 2.2 打牌机制
As a 游戏开发者,
I want 实现玩家打牌功能，
so that 游戏可以持续进行。

**验收标准**:
1. 1: 玩家可以选择手牌中的一张打出
2. 2: 打出的牌进入公共区域
3. 3: 打牌后更新玩家手牌数量

#### Story 2.3 游戏状态跟踪
As a 游戏开发者,
I want 跟踪游戏状态和玩家信息，
so that 系统知道当前轮到谁操作。

**验收标准**:
1. 1: 准确跟踪当前轮到的玩家
2. 2: 记录每位玩家的手牌数量
3. 3: 更新牌墙剩余牌数

### Epic 3: 响应处理系统
实现吃、碰、杠、胡等玩家响应处理

#### Story 3.1 暗杠处理
As a 游戏开发者,
I want 实现暗杠功能，
so that 玩家可以在满足条件时进行暗杠操作。

**验收标准**:
1. 1: 系统检测玩家是否拥有四张相同牌
2. 2: 暗杠后正确更新玩家手牌
3. 3: 暗杠操作符合麻将规则

#### Story 3.2 响应检测
As a 游戏开发者,
I want 检测其他玩家对打出牌的响应，
so that 玩家可以进行吃、碰、杠、胡操作。

**验收标准**:
1. 1: 系统正确检测吃、碰、杠、胡的可能性
2. 2: 提供响应选项给符合条件的玩家
3. 3: 响应处理符合麻将规则

#### Story 3.3 响应执行
As a 游戏开发者,
I want 执行玩家的响应操作，
so that 游戏可以正确处理吃、碰、杠、胡。

**验收标准**:
1. 1: 正确执行玩家选择的响应操作
2. 2: 更新相关玩家的手牌和游戏状态
3. 3: 响应结果符合麻将规则

### Epic 4: 胜负判定与游戏结束
实现胡牌判断和游戏结束逻辑

#### Story 4.1 胡牌评估
As a 游戏开发者,
I want 实现基础胡牌评估功能，
so that 系统可以判断玩家是否胡牌。

**验收标准**:
1. 1: 系统能够识别平胡等简单牌型
2. 2: 胡牌判断准确无误
3. 3: 符合传统麻将胡牌规则

#### Story 4.2 游戏结束处理
As a 游戏开发者,
I want 处理游戏结束和结果宣布，
so that 玩家知道游戏结果。

**验收标准**:
1. 1: 准确识别游戏结束条件
2. 2: 正确宣布获胜者
3. 3: 显示游戏结果和得分

## 7. 扩展性需求 (Extensibility Requirements)

### 7.1 规则扩展性
1. **ER1**: 系统应支持多种麻将规则变种的插件化扩展，如国标麻将、广东麻将、四川麻将等
2. **ER2**: 胡牌算法应设计为可配置模块，允许添加新的胡牌牌型
3. **ER3**: 游戏参数（如起始手牌数、牌墙长度等）应可通过配置文件调整

### 7.2 功能扩展性
1. **ER4**: 系统应预留接口以支持AI玩家的集成
2. **ER5**: 应支持观战模式的扩展，允许非参与者观看正在进行的游戏
3. **ER6**: 系统应具备聊天功能的扩展能力，支持游戏内文字、表情交流
4. **ER7**: 应支持游戏回放功能的扩展，记录并重现完整游戏过程

### 7.3 平台扩展性
1. **ER8**: 系统架构应支持多平台部署，包括Web、iOS、Android
2. **ER9**: 应设计统一的API接口，便于第三方客户端接入
3. **ER10**: 系统应支持微服务架构的演进，便于功能模块独立扩展

### 7.4 技术扩展性
1. **ER17**: 应采用模块化设计，确保各功能组件可独立升级
2. **ER18**: 数据库设计应支持水平扩展，应对用户增长

## 8. 未来发展规划 (Future Development Roadmap)

### 8.1 短期规划（3-6个月）
- 完善基础游戏功能，优化用户体验
- 添加简单的AI对手

### 8.2 中期规划（6-12个月）
- 支持多种地方麻将规则

### 8.3 长期规划（1年以上）
- 扩展至其他棋牌游戏
- 构建完整的在线棋牌社区
- 实现VR/AR版本的麻将游戏

## 9. 检查表结果报告
(此部分将在PRD完成后运行检查表工具时填充)

## 10. 下一步 (Next Steps)

### 10.1 UX专家提示
请根据此PRD创建麻将游戏的用户界面设计，重点关注直观的游戏状态展示和便捷的操作界面。

### 10.2 架构师提示
请根据此PRD设计系统架构，特别关注实时游戏状态同步、玩家操作处理和游戏逻辑验证。